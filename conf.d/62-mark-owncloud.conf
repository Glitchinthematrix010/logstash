filter {
  if [http_response_code] == 401 and [message] =~ /^\/owncloud\/remote\.php\// { 
    mutate {
      add_tag => [ "Known Message" ]
      remove_tag => [ "Unknown Message" ]
    }
  }
  if [http_response_code] == 404 and [message] =~ /\/owncloud\/index\.php\/core\/preview.png\?file=[a-zA-Z0-9_.-]+&c=[a-fA-F0-9]+&x=32&y=32&forceIcon=0/ { 
    mutate {
      add_tag => [ "Known Message", "Benign" ]
      remove_tag => [ "Unknown Message" ]
    }
  }
  if [type] == "apache_access" and [message] =~ /^\/owncloud/ and [http_response_code] < 400 {
    mutate {
      add_field=> { "application" => "owncloud" }
    } 
    grok {
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      tag_on_failure => [ ]
      add_tag => [ "Known Message", "Benign" ]
      match => { "message" => [
        "^/owncloud$",
        "^/owncloud(?:/)$",
        "^/owncloud/apps/activity/css/style\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/activity/img/(activity|add-color)\.svg$",
        "^/owncloud/apps/activity/js/(filesplugin|script)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/activity/js/activity(collection|model|tabview)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/activity/js/formatter\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/announcementcenter/css/style\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/announcementcenter/img/announcementcenter\.svg$",
        "^/owncloud/apps/announcementcenter/js/script\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/bookmarks/css/3rdparty/jquery\.tagit\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/bookmarks/css/bookmarks\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/bookmarks/img/bookmarks\.svg$",
        "^/owncloud/apps/bookmarks/js/(bookmarks|settings)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/bookmarks/js/3rdparty/(js_tpl|tag-it)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/c(ontacts|alendar)/js/loader\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/3rdparty/chosen/(cs|j)s/chosen(\.jquery\.min)?\.(css|js)\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/3rdparty/fullcalendar/(cs|j)s/fullcalendar\.(cs|j)s\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/3rdparty/jquery\.multiselect/(cs|j)s/jquery\.multiselect\.(cs|j)s\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/3rdparty/jsTz/jstz-[\d.]+\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/3rdparty/miniColors/(cs|j)s/jquery\.miniColors\.(min\.)?(cs|j)s\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/3rdparty/timepicker/(cs|j)s/jquery\.ui\.timepicker\.(cs|j)s\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/css/(share|style)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/calendar/img/calendar\.svg$",
        "^/owncloud/apps/calendar/js/(calendar|on-event|settings|share|jquery\.multi-autocomplete).js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/comments/css/comments\.css\?v=%{BASE16NUM}$",
        "^/owncloud/apps/comments/js/app\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/comments/js/comment(collection|model|stabview|summarymodel)\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/comments/js/filesplugin\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/contacts/css/(contacts|multi-select|share)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/css/jquery\.(Jcrop\.min|ocaddnew)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/img/(app|contacts)\.svg$",
        "^/owncloud/apps/contacts/js/(addressbooks|app|contacts|groups|jquery\.ocaddnew|modernizr\.custom|otherbackendconfig|share|storage)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/vendor/blueimp-file-upload/js/jquery\.fileupload\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/vendor/blueimp-md5/js/md5\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/vendor/combobox\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/vendor/jcrop/js/jquery\.Jcrop\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/vendor/ui-multiselect/jquery\.multiselect\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/contacts/vendor/ui-multiselect/src/jquery\.multiselect\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/direct_menu/css/direct_menu\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/documents/css/(share|style)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/documents/css/3rdparty/webodf/(dojo-app|wodotexteditor|wodocollabpane)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/documents/img/documents\.svg$",
        "^/owncloud/apps/documents/js/(documents|share)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/documents/js/3rdparty/resources/dijit/themes/claro/claro\.css$",
        "^/owncloud/apps/documents/js/3rdparty/resources/dojox/layout/resources/ExpandoPane\.css$",
        "^/owncloud/apps/documents/js/3rdparty/resources/dojox/widget/ColorPicker/ColorPicker\.css$",
        "^/owncloud/apps/documents/js/3rdparty/webodf/(dojo-amalgamation|webodf-debug)\.js\?_=\d+$",
        "^/owncloud/apps/documents/js/admin\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/documents/js/viewer/viewer\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/external/js/admin\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/federation/css/settings-admin\.css?v=%{OCVTOKEN}$",
        "^/owncloud/apps/federation/js/settings-admin\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files/css/(detailsView|files|mobile|upload)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files/img/(delete|external|folder|public|share|star)\.svg$",
        "^/owncloud/apps/files/js/(app|breadcrumb|detailfileinfoview|detailsview|detailtabview|favoritesfilelist|files|filesummary|file-upload|favoritesplugin|fileactions|fileactionsmenu|fileinfomodel|filelist|keyboardshortcuts|mainfileinfodetailview|navigation|newfilemenu|search|tagsplugin)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files/js/admin\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files/js/jquery(\.fileupload|\.iframe-transport|-visibility)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_external/css/(external|settings)\.css\?v=%{BASE16NUM}$",
        "^/owncloud/apps/files_external/js/(app|mountsfilelist|rollingqueue|statusmanager|oauth(1|2)|public_key|settings)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_mv/css/mv\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_mv/js/move\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_pdfviewer/css/(style|viewer)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_pdfviewer/img/toolbarButton-secondaryToolbarClose\.svg$",
        "^/owncloud/apps/files_pdfviewer/js/(previewplugin|workersrc)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/build/pdf(\.worker)?\.js\?v=%{NUMBER}$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/compatibility\.js\?v=%{NUMBER}$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/images/texture\.png$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/images/toolbarButton-(menuArrows|page(|Down|Up)|secondaryToolbarToggle|sidebarToggle|view(Attachments|Outline|Thumbnail)|zoom(In|Out))\.png$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/l10n\.js\?v=%{NUMBER}$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/locale/en-US/viewer\.properties$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/locale/locale.properties\?v=%{NUMBER}$",
        "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/viewer\.(j|cs)s\?v=%{NUMBER}$",
        "^/owncloud/apps/files_sharing/css/sharetabview\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_sharing/js/(app|external|settings-admin|share|sharedfilelist|sharetabview)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_texteditor/css/(mobile|style)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_texteditor/css/DroidSansMono/stylesheet\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_texteditor/js/editor\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_texteditor/js/vendor/ace/src-noconflict/(ace|mode-python|theme-clouds)\.js\?_=%{BASE10NUM}$",
        "^/owncloud/apps/files_texteditor/js/vendor/ace/src-noconflict/ace\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_trashbin/css/trash\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_trashbin/js/(app|filelist)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_versions/css/versions\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_versions/js/(filesplugin|versioncollection|versionmodel|versionstabview)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_video(play|view)er/css/(style|mediaelementplayer)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/files_video(play|view)er/js/viewer\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/firstrunwizard/css/(colorbox|firstrunwizard)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/firstrunwizard/js/(firstrunwizard|jquery\.colorbox)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/gallery/css/(gallerybutton|slideshow)\.css\?v=%{BASE16NUM}$",
        "^/owncloud/apps/gallery/img/app\.svg$",
        "^/owncloud/apps/gallery/js/gallery(button|fileaction|utility)\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/gallery/js/slideshow(controls|zoomablepreview)?\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/gallery/js/vendor/bigshot/bigshot-compressed\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/gallery/js/vendor/dompurify/src/purify\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/galleryplus/css/(gallerybutton|slideshow|github-markdown|mobile|share|styles)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/img/(app|dateasc|datedes|nameasc|namedes|download|toggle)\.svg$",
        "^/owncloud/apps/galleryplus/js/(app|breadcrumb|eventsource|gallery|galleryalbum|galleryconfig|galleryimage|galleryinfobox|galleryrow|galleryutility|galleryview|thumbnail)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/js/(gallerybutton|galleryfileaction|slideshow|slideshowcontrols|slideshowzoomablepreview)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/js/vendor/bigshot/bigshot-compressed\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/js/vendor/commonmark/dist/commonmark\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/js/vendor/dompurify/src/purify\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/js/vendor/image-scale/image-scale\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/js/vendor/modified-eventsource-polyfill/eventsource-polyfill\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/galleryplus/js/vendor/owncloud/share\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/css/(mobile|style|style-controls|style-sidebar|tablet)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/img/(music|pause-big|play-big|play-next|play-previous|repeat|shuffle)\.svg$",
        "^/owncloud/apps/music/js/app/playerwrapper\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/public/(app|fileactions|musicFilePlayer)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/vendor/angular-gettext/dist/angular-gettext\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/vendor/angular-route/angular-route\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/vendor/angular/angular\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/vendor/aurora/(aurora|flac|mp3)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/vendor/restangular/dist/restangular\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/vendor/soundmanager/script/soundmanager2-nodebug-jsmin\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/music/js/vendor/underscore/underscore-min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/notifications/css/styles\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/notifications/img/notifications\.svg$",
        "^/owncloud/apps/notifications/js/(app|notification)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/ownnote/img/app\.svg$",
        "^/owncloud/apps/ownnote/js/admin\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/ownnote/l10n/en\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/search_lucene/css/lucene\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/search_lucene/js/checker\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/shorten/js/(admin|script)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/systemtags/css/systemtagsfilelist\.css\?v=%{BASE16NUM}$",
        "^/owncloud/apps/systemtags/img/tag\.svg$",
        "^/owncloud/apps/systemtags/js/(app|filesplugin|systemtagsfilelist|systemtagsinfoview)\.js\?v=%{BASE16NUM}$",
        "^/owncloud/apps/templateeditor/css/settings-admin\.css?v=%{OCVTOKEN}$",
        "^/owncloud/apps/templateeditor/js/settings-admin\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/css/settings\.css?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/img/copy\.svg$",
        "^/owncloud/apps/user_ldap/js/wizard/(configModel|controller|view|wizard)\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/js/wizard/wizardDetector(AvailableAttributes|BaseDN|ClearGroupMappings|ClearUserMappings|EmailAttribute|FeatureAbstract|FilterGroup|FilterLogin|FilterUser|Generic|GroupCount|GroupObjectClasses|GroupsForUsers|Port|Queue|SimpleRequestAbstract|TestAbstract|TestBaseDN|TestConfiguration|TestLoginName|UserCount|UserDisplayNameAttribute|UserGroupAssociation|UserObjectClasses)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/js/wizard/wizardFilterOnType(Factory)?\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/js/wizard/wizardObject\.js?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/js/wizard/wizardTab(AbstractFilter|Advanced|Elementary|Expert|Generic|GroupFilter|LoginFilter|UserFilter)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/vendor/ui-multiselect/jquery\.multiselect\.css?v=%{OCVTOKEN}$",
        "^/owncloud/apps/user_ldap/vendor/ui-multiselect/src/jquery\.multiselect\.js?v=%{OCVTOKEN}$",
        "^/owncloud/core/css/(apps|fixes|fonts|header|icons|jquery\.ocdialog|jquery-ui-fixes|mobile|multiselect|share|styles|tooltip)\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/core/css/global\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/core/css/images/ui-(icons|bg_flat|bg_glass|bg_flat|bg_highlight-soft)(_\d+)?_${BASE16NUM}_\d+x\d+\.png$",
        "^/owncloud/core/css/images/ui-bg_(flat|glass|highlight-soft)_%{BASE10NUM}_%{BASE16NUM}_%{BASE10NUM}x%{BASE10NUM}\.png$",
        "^/owncloud/core/css/images/ui-icons_%{BASE16NUM}_%{BASE10NUM}x%{BASE10NUM}\.png$",
        "^/owncloud/core/css/inputs\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/core/css/systemtags\.css\?v=%{OCVTOKEN}$",
        "^/owncloud/core/fonts/OpenSans-(Light|Regular|Semibold)\.woff$",
        "^/owncloud/core/img/(breadcrumb|favicon|loading|loading-dark|loading-small|logo-icon)\.(?:gif|png|svg)$",
        "^/owncloud/core/img/actions/(add|caret|checkbox|checkbox-checkedclose|confirm|delete|download|history|logout|menu|more|play|search-white|settings|share|star|toggle-filelist|toggle-pictures|triangle-n|triangle-s)\.svg$",
        "^/owncloud/core/img/actions/(checkmark|checkmark-white|close|details|info|mail|rename|starred|upload|public|delete-hover|view-close|view-next|view-pause|view-play|view-previous)\.svg$",
        "^/owncloud/core/img/actions/checkbox-checked\.svg$",
        "^/owncloud/core/img/actions/info\.png$",
        "^/owncloud/core/img/favicon-touch\.png$",
        "^/owncloud/core/img/filetypes/(application|application-pdf|file|folder|folder-external|image|package-x-generic|text|text-code|x-office-document|package-x-generic|x-office-spreadsheet)\.svg$",
        "^/owncloud/core/img/places/(files|home)\.svg$",
        "^/owncloud/core/js/(apps|avatar|compatability|config|eventsource|jquery\.avatar|jquery\.ocdialog|js|l10n|login|lostpassword|mimetype|mimetypelist)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/(compatibility|tags)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/(oc-backbone|oc-dialogs|oc-requesttoken|octemplate|placeholders?|share|shareconfigmodel|sharedialogexpirationview|sharedialoglinkshareview|sharedialogresharerinfoview|sharedialogshareelistview|sharedialogview|shareitemmodel|visitortimezone)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/files/(client|fileinfo)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/multiselect\.js?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/oc-backbone-webdav\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/select2-toggleselect\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/setupchecks\.js?v=%{OCVTOKEN}$",
        "^/owncloud/core/js/systemtags/systemtag(model|s|scollection|sinputfield|smappingcollection)\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/search/js/search\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/search/templates/part\.results\.html$",
        "^/owncloud/core/vendor/[-\w_/]+/([-\w./]+/)?[-\w.]+\.(css|js)\?v=[a-f0-9]+?$",
        "^/owncloud/core/vendor/backbone/backbone\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/blueimp-md5/js/md5\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/bootstrap/js/tooltip\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/davclient\.js/lib/client\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/handlebars/handlebars\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/jquery-migrate/jquery-migrate\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/jquery-ui/themes/base/jquery-ui\.css?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/jquery-ui/ui/jquery-ui\.custom\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/jquery/jquery\.min\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/jsTimezoneDetect/jstz\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/moment/min/moment-with-locales\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/select2/select2\.png$",
        "^/owncloud/core/vendor/snapjs/dist/latest/snap\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/core/vendor/underscore/underscore\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/index\.php/apps/activity/$",
        "^/owncloud/index\.php/apps/activity/activities/fetch\?filter=all&page=\d+$",
        "^/owncloud/index\.php/apps/activity/activities/fetch\?page=\d+&filter=filter&objectid=\d+&objecttype=files$",
        "^/owncloud/index\.php/apps/activity/api/v2/activity/filter?format=json&object_type=files&object_id=%{BASE10NUM}$",
        "^/owncloud/index\.php/apps/announcementcenter/$",
        "^/owncloud/index\.php/apps/announcementcenter/announcement\?page=\d+$",
        "^/owncloud/index\.php/apps/bookmarks/(bookmark/click|tag)?$",
        "^/owncloud/index\.php/apps/bookmarks/bookmark\?type=(bookmark|rel_tags)&tag=&page=\d+&sort=bookmarks_sorting_recent$",
        "^/owncloud/index\.php/apps/calendar/(ajax/cache/status\.php)?$",
        "^/owncloud/index\.php/apps/calendar/ajax/calendar/(activation|changeview|edit|update)(\.form)\.php$",
        "^/owncloud/index\.php/apps/calendar/ajax/event/(delete|edit|new)\.(form\.)?php$",
        "^/owncloud/index\.php/apps/calendar/ajax/events\.php\?calendar_id=[a-zA-Z0-9_-]+&start=\d+&end=\d+(&_=\d+)?$",
        "^/owncloud/index\.php/apps/calendar/ajax/settings/get(firstday|timezonedetection|timeformat)\.php$",
        "^/owncloud/index\.php/apps/calendar/ajax/settings/timeformat\.php$",
        "^/owncloud/index\.php/apps/calendar/export\.php\?calid=\w+$",
        "^/owncloud/index\.php/apps/calendar/js/idtype\.php\?id=(\d+|new)&_=\d+$",
        "^/owncloud/index\.php/apps/calendar/js/l10n\.php$",
        "^/owncloud/index\.php/apps/contacts/$",
        "^/owncloud/index\.php/apps/contacts/addressbook/local/%{BASE10NUM}/contact/(%{BASE10NUM}|add)$",
        "^/owncloud/index\.php/apps/contacts/addressbook/local/%{BASE10NUM}/contacts?(/%{BASE10NUM}/photo\?maxSize=%{BASE10NUM})?$",
        "^/owncloud/index\.php/apps/contacts/addressbooks/$",
        "^/owncloud/index\.php/apps/contacts/ajax/config\.js\?_=\d+$",
        "^/owncloud/index\.php/apps/contacts/connectors/%7Bbackend%7D$",
        "^/owncloud/index\.php/apps/contacts/groups/$",
        "^/owncloud/index\.php/apps/contacts/groups/addto/%{BASE10NUM}$",
        "^/owncloud/index\.php/apps/contacts/preference/set$",
        "^/owncloud/index\.php/apps/documents/ajax/documents/list$",
        "^/owncloud/index\.php/apps/documents/ajax/mimes\.php$",
        "^/owncloud/index\.php/apps/documents/index$",
        "^/owncloud/index\.php/apps/files(\?dir=(%{OCPATH})?)?$",
        "^/owncloud/index\.php/apps/files/$",
        "^/owncloud/index\.php/apps/files/?dir=%2FInstantUpload$",
        "^/owncloud/index\.php/apps/files/\?dir=%{URIPATH}$",
        "^/owncloud/index\.php/apps/files/ajax/(list|scan|getstoragestats)\.php\?(force=(true|false)&)?dir=(%{OCPATH})?&?(sort=name&)?(sortdirection=(asc|des)&?)?(requesttoken=%{OCTOKEN})?$",
        "^/owncloud/index\.php/apps/files/ajax/download\.php\?dir=%{OCPATH}$",
        "^/owncloud/index\.php/apps/files/ajax/download\.php\?dir=(%{OCPATH})?&files=[a-zA-Z0-9%. -]+&downloadStartSecret=[a-z0-9]+$",
        "^/owncloud/index\.php/apps/files/ajax/upload.php$",
        "^/owncloud/index\.php/apps/files_external/globalstorages(/%{BASE10NUM})?$",
        "^/owncloud/index\.php/apps/files_external/userglobalstorages/%{BASE10NUM}$",
        "^/owncloud/index\.php/apps/files_pdfviewer/\?file=%{OCPATH}$",
        "^/owncloud/index\.php/apps/files_sharing/api/externalShares$",
        "^/owncloud/index\.php/apps/files_texteditor/ajax/loadfile\?filename=[a-zA-Z0-9%.-]+&dir=%{OCPATH}$",
        "^/owncloud/index\.php/apps/files_texteditor/ajax/savefile$",
        "^/owncloud/index\.php/apps/gallery/config\?extramediatypes=%{BASE10NUM}$",
        "^/owncloud/index\.php/apps/galleryplus/$",
        "^/owncloud/index\.php/apps/galleryplus/config\?$",
        "^/owncloud/index\.php/apps/galleryplus/config\?extramediatypes=1$",
        "^/owncloud/index\.php/apps/galleryplus/files/download/\d+\?c=%{BASE16NUM}&requesttoken=%{OCTOKEN}$",
        "^/owncloud/index\.php/apps/galleryplus/files/list\?location=(%{OCPATH})?&mediatypes=[a-z%A-F0-9-]+&features=&etag(=%{BASE16NUM})?$",
        "^/owncloud/index\.php/apps/galleryplus/preview/%{BASE10NUM}\?c=%{BASE16NUM}&width=\d+&height=\d+&requesttoken=%{OCTOKEN}$",
        "^/owncloud/index\.php/apps/galleryplus/slideshow$",
        "^/owncloud/index\.php/apps/galleryplus/thumbnails\?ids=[0-9A-F%]+&scale=\d+&square=(0|1)&requesttoken=%{OCTOKEN}$",
        "^/owncloud/index\.php/apps/music/$",
        "^/owncloud/index\.php/apps/music/api/album/\d+/cover$",
        "^/owncloud/index\.php/apps/music/api/collection$",
        "^/owncloud/index\.php/apps/music/api/scan\?dry=1$",
        "^/owncloud/index\.php/apps/user_ldap/ajax/(get|test)Configuration.php$",
        "^/owncloud/index\.php/apps/user_ldap/ajax/wizard\.php$",
        "^/owncloud/index\.php/avatar/%{USER:username_dst}/(32|64|128|256)$",
        "^/owncloud/index\.php/core/ajax/share\.php\?fetch=getItem&itemType=calendar&itemSource=\d+&checkReshare=true&checkShares=true$",
        "^/owncloud/index\.php/core/ajax/share\.php\?fetch=getItemsSharedStatuses&itemType=(addressbook|calendar|file)$",
        "^/owncloud/index\.php/core/js/oc\.js\?v=%{OCVTOKEN}$",
        "^/owncloud/index\.php/core/preview\.png\?file=%{OCPATH}&c=%{BASE16NUM}&x=%{BASE10NUM}&y=%{BASE10NUM}&forceIcon=(0|1)$",
        "^/owncloud/index\.php/displaynames$",
        "^/owncloud/index\.php/settings/admin$",
        "^/owncloud/index\.php/settings/ajax/checksetup$",
        "^/owncloud/index\.php\?logout=true&requesttoken=%{OCTOKEN}$",
        "^/owncloud/index\.php\?redirect_url=%{OCPATH}*$",
        "^/owncloud/ocs/v1\.php/apps/files_external/api/v1/mounts\?format=json$",
        "^/owncloud/ocs/v1\.php/apps/files_sharing/api/v1/shares(\?path=%{URIPATH}(&reshares=true)?&subfiles=(true|false))?$",
        "^/owncloud/ocs/v1\.php/cloud/activity\?page=\d+&pagesize=\d+&format=json$",
        "^/owncloud/ocs/v1\.php/cloud/capabilities\?format=json$",
        "^/owncloud/ocs/v2\.php/apps/notifications/api/v1/notifications\?format=json$",
        "^/owncloud/remote\.php/ca(rd|l)dav/$",
        "^/owncloud/remote\.php/ca(rd|l)dav/(calendars|principals)/(%{USER:username_dst}/)?(contact_birthdays|defaultcalendar)?/?$",
        "^/owncloud/remote\.php/carddav/addressbooks/%{USER:username_dst}/((shard_)?contacts/([a-zA-Z0-9_./-]+)?([A-F0-9-]+.vcf)?)?$",
        "^/owncloud/remote\.php/dav/systemtags-relations/files/%{BASE10NUM}$",
        "^/owncloud/settings/css/settings\.css?v=%{OCVTOKEN}$",
        "^/owncloud/settings/img/(admin|apps)\.svg$",
        "^/owncloud/settings/img/(help|personal|users)\.svg$",
        "^/owncloud/settings/js/(admin|certificates|log|settings)\.js?v=%{OCVTOKEN}$"
      ] }
    }
  }
  if [type] == "owncloud" {
    mutate {
      add_field => { "application" => "owncloud" }
      rename => { "remoteAddr" => "src" }
      rename => { "url" => "http_request" }
      rename => { "method" => "http_verb" }
      rename => { "app" => "owncloud_app" }
      rename => { "reqId" => "owncloud_reqId" }
      rename => { "level" => "owncloud_level" }
    }
    if [http_request] =~ /\/notifications$/ and [message] == "Current user is not logged in" {
      mutate {
        add_tag => [ "Known Message", "Benign" ]
      }
    } 
    if [message] and "Known Message" not in [tags] {
      grok {
        tag_on_failure => [ ]
        add_tag => [ "Known Message", "Error" ]
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        match => { "message" => [
          "^%{PATH} is locked$",
          "^Failed to connect to the database: An exception occured in driver: SQLSTATE\[HY000\] \[2005\] Unknown MySQL server host \'%{IP_DST}\' \(2\)$",
          "^File: %{PATH} modified since opening\.$",
          "^HTTP\/(1\.1|1\.0|2\.0) 501 There was no handler found for this \"LOCK\" method$",
          "^HTTP\/(1\.1|1\.0|2\.0) 503 Doctrine\\DBAL\\DBALFailed to connect to the database: An exception occured in driver: SQLSTATE\[HY000\] \[2005\] Unknown MySQL server host \'%{IP_DST}\' \(2\)$",
          "^HTTP\/(1\.1|1\.0|2\.0) 503 OC\\ServerNotAvailableLost connection to LDAP server\.$",
          "^Lost connection to LDAP server\.$",
          "^OCA\\Contacts\\Backend\\Database::getContact, Not found, id: %{BASE10NUM}$"
        ] }
      }
    } 
    if [message] and "Known Message" not in [tags] {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "(?m)^initializing paged search for  ?Filter (objectClass=\*|nsUniqueId=[a-f0-9-]+|(\(&)?\(&\(\|\(objectclass=nestedgroup\)\)\(\|(\(cn=%{DATA}\))+\)\)(\(cn=\*\))?)(\))? base Array\n\(\n    \[0\] => (uid=%{USER:username_dst},)?cn=users,cn=accounts,%{SITE_LDAP_BASE}\n\)\n attr Array\n\(\n    \[0\] => %{OC_LDAP_USER_ATTRS}\n\)\n limit (500|2) offset 0$",
          "(m?)^initializing paged search for  ?Filter (objectClass=\*|(\(&)?\(&\(\|\(objectclass=nestedgroup\)\)\(\|(\(cn=%{DATA}\))+\)\)(\(cn=\*\))?)(\))? base Array\n\(\n\s+\[0\] => (cn=%{DATA:group_dst},)?cn=groups,cn=accounts,%{SITE_LDAP_BASE}\n\)\n attr Array\n\(\n(\s+\[\d\] => (cn|dn|member(Of)?|primaryGroupToken)?\n)+\)\n limit (500|2) offset 0$",
          "(m?)^initializing paged search for  ?Filter ipaUniqueID=[0-9a-f-]+ base Array\n\(\n\s+\[0\] => cn=users,cn=accounts,%{SITE_LDAP_BASE}\n\)\n attr Array\n\(\n\s+\[0\] => (cn|dn|member(Of)?|primaryGroupToken)?\n\)\n limit (500|2) offset 0$",
          "^(Run|Finished) job with ID \d+$",
          "^Count filter: objectclass=*$",
          "^Expire: %{URIPATH:filename_dst}\.v%{BASE10NUM}$",
          "^Generating preview for \".+\" with \"OC\\Preview\\\w+\"$",
          "^HTTP\/(1\.1|1\.0|2\.0) 401 No 'Authorization: Basic' header found. Either the client didn't send one, or the server is mis-configured$",
          "^HTTP\/(1\.1|1\.0|2\.0) 401 No basic authentication headers were found$",
          "^HTTP\/(1\.1|1\.0|2\.0) 401 Username or password does not match$",
          "^HTTP\/(1\.1|1\.0|2\.0) 404 File with name [ .a-zA-Z0-9_+/-]+ could not be located$",
          "^HTTP\/(1\.1|1\.0|2\.0) 405 The resource you tried to create already exists$",
          "^HTTP\/(1\.1|1\.0|2\.0) 423 \"[0-9a-zA-Z_. -]+\" is locked$",
          "^Login failed: \'%{USER:username_dst}\' \(Remote IP: \'%{IP_SRC}\'\)$",
          "^Looking for cookie L/O 500/0$",
          "^Mark to expire %{DATA:filename_dst} next version should be %{BASE10NUM} or smaller\. \(prevTimestamp: %{BASE10NUM}; step: %{BASE10NUM}$",
          "^No DN found for  on ldaps://%{SITE_LDAP_SERVERS}/$",
          "^No paged search for us, Cpt., Limit %{BASE10NUM} Offset %{BASE10NUM}$",
          "^OCA\\Contacts\\Contact::setPropertyByChecksum adding: TEL( [0-9(). -]+)?$",
          "^OCA\\Contacts\\Contact::setPropertyByName adding: (FN|NOTE) .*$",
          "^OCA\\Contacts\\Hooks::contactAdded id: %{BASE10NUM}$",
          "^OCA\\Contacts\\Utils\\Properties::purgeIndexes, ids: Array$",
          "^OCA\\Contacts\\Utils\\Properties::purgeIndexes, ids: Array\n\(\n   \[0\] => \d+\n\)",
          "^OC_Image->fixOrientation\(\) (Orientation: -?\d+|Image is not a JPEG\.)$",
          "^Paged search was not available$",
          "^Ready for a paged search$",
          "^Requested attribute (displayname|thumbnailphoto|jpegphoto|mail|primarygroupid) not found for uid=%{USER:username_dst},cn=users,cn=accounts,dc=mossholder,dc=com$",
          "^Requested attribute .* not found for cn=.*%{SITE_LDAP_BASE}$",
          "^Run background job \"updateGroups\"$",
          "^Secured pdf file are currently not supported\.",
          "^\d+ orphaned ((user|system) tag relations|comments|read marks) deleted$",
          "^\d+ orphaned comment read marks deleted$",
          "^\d+ orphaned share\(s\) deleted$",
          "^adding \d+ {\"boost\":1}$",
          "^background job (indexing \d+ files|optimizing index) for %{USER:username_dst}$",
          "^bgJ \"updateGroups\" – (FINISHED )?[dD]ealing with ((creat|remov)ed|known) [gG]roups\.$",
          "^bgJ \"updateGroups\" – Finished\.$",
          "^delete - \d+$",
          "^found \d+ hits for file id [ #.a-zA-Z0-9_+/-]+$",
          "^getGroups Filter (objectClass=\*|(\(&)?\(&\(\|\(objectclass=nestedgroup\)\)\(\|(\(cn=%{DATA}\))+\)\)(\(cn=\*\))?)(\))?$",
          "^getGroups getGroups--500-0$",
          "^getGroups\(\): read \d+ at offset \d+ \(limit: 500\)$",
          "^getUsers: Options: search  limit 500 offset (500)? Filter: \(&\(&\(|\(objectclass=inetorgperson\)\)\(|\(memberof=cn=%{USER:group_dst},cn=groups,cn=accounts,%{SITE_LDAP_BASE}\)\)\)\(displayname=\*\)\(displayname=\*\)\)$",
          "^getUsers: \d+ Users found$",
          "^max(X|Y) reduced from \d+ to \d+$",
          "^optimizing index$",
          "^readAttribute: cn=%{USER:group_dst},cn=groups,cn=accounts,%{SITE_LDAP_BASE} found$",
          "^readAttribute: uid=%{USER:username_dst},cn=users,cn=accounts,%{SITE_LDAP_BASE} found$",
          "^removed \d+ files from index$",
          "^removed entities - albums: \[\], artists: \[\]$",
          "^removing \d+:[ #.a-zA-Z0-9_+/-]+ from index$",
          "^update - [ #.a-zA-Z0-9_+/%-]+$",
          "^update - mimetype [a-zA-Z0-9-]+/[a-zA-Z0-9-]+$"
        ] }
      }
    }  
  }
}
