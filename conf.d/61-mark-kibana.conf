filter {
  if [type] == "kibana" {
    mutate {
      add_field => { "application" => "Kibana" }
    }
    if [message] {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^GET / 200 - %{BASE10NUM}ms$",
          "^GET /\.kibana/_mapping/*/field/_source\?_=%{BASE10NUM} 200 - %{BASE10NUM}ms$",
          "^GET /\?_=i%{BASE10NUM} 200 - %{BASE10NUM}ms$",
          "^GET /_nodes\?_=%{BASE10NUM} 200 - %{BASE10NUM}ms$",
          "^GET /bower_components/font-awesome/fonts/fontawesome-webfont\.woff\?v=[0-9v.]+ 304 - %{BASE10NUM}ms$",
          "^GET /bower_components/requirejs/require\.js\?_b=%{BASE10NUM} 304 - %{BASE10NUM}ms$",
          "^GET /config\?_b=%{BASE10NUM} 304 - %{BASE10NUM}ms$",
          "^GET /images/initial_load\.gif 304 - %{BASE10NUM}ms$",
          "^GET /images/no_border\.png 304 - %{BASE10NUM}ms$",
          "^GET /index\.js\?_b=%{BASE10NUM} 304 - %{BASE10NUM}ms$",
          "^GET /require\.config\.js\?_b=%{BASE10NUM} 304 - %{BASE10NUM}ms$",
          "^GET /styles/main\.css\?_b=%{BASE10NUM} 304 - %{BASE10NUM}ms$",
          "^GET /styles/theme/elk\.ico 304 - %{BASE10NUM}ms$",
          "^GET /worker-json\.js 304 - %{BASE10NUM}ms$",
          "^HEAD /\.kibana 200 - %{BASE10NUM}ms$",
          "^POST /\.kibana/__kibanaQueryValidator/_validate/query\?explain=true&ignore_unavailable=true 200 - %{BASE10NUM}ms$",
          "^POST /\.kibana/index-pattern/_search\?fields= 200 - %{BASE10NUM}ms$",
          "^POST /\.kibana/search/_search\?size=%{BASE10NUM} 200 - %{BASE10NUM}ms$",
          "^POST /_mget\?timeout=0&ignore_unavailable=true&preference=%{BASE10NUM} 200 - %{BASE10NUM}ms$",
          "^POST /_msearch\?timeout=0&ignore_unavailable=true&preference=%{BASE10NUM} 200 - %{BASE10NUM}ms$"
        ] }
      }
    }  
  }
  if [type] == "apache_access" and [message] =~ /^\/kibana/ and [http_response_code] < 400 {
    mutate {
      add_field => { "application" => "Kibana" }
    }
    grok {
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      tag_on_failure => [ "Unknown Message" ]
      add_tag => [ "Known Message", "Benign" ]
      match => { "message" => [
        "^/kibana(/)?(\?)?$",
        "^/kibana/api/status$",
        "^/kibana/app/kibana$",
        "^/kibana/bower_components/font-awesome/fonts/fontawesome-webfont\.woff\?v=[0-9.]+$",
        "^/kibana/bower_components/requirejs/require\.js\?_b=%{BASE10NUM}$",
        "^/kibana/bundles/commons\.bundle\.js\?v=%{BASE10NUM}$",
        "^/kibana/bundles/commons\.style\.css\?v=%{BASE10NUM}$",
        "^/kibana/bundles/kibana\.bundle\.js\?v=%{BASE10NUM}$",
        "^/kibana/bundles/kibana\.style\.css\?v=%{BASE10NUM}$",
        "^/kibana/bundles/node_modules/bootstrap/fonts/glyphicons-halflings-regular\.woff2$",
        "^/kibana/bundles/node_modules/font-awesome/fonts/fontawesome-webfont\.woff2$",
        "^/kibana/bundles/src/ui/public/images/elk\.ico$",
        "^/kibana/bundles/src/ui/public/images/kibana\.svg$",
        "^/kibana/bundles/statusPage\.bundle\.js\?v=%{BASE10NUM}$",
        "^/kibana/bundles/statusPage\.style\.css\?v=%{BASE10NUM}$",
        "^/kibana/config\?_b=%{BASE10NUM}$",
        "^/kibana/elasticsearch/(\?_=%{BASE10NUM})?$",
        "^/kibana/elasticsearch/\.kibana$",
        "^/kibana/elasticsearch/\.kibana/__kibanaQueryValidator/_validate/query\?explain=(true|false)&ignore_unavailable=(true|false)$",
        "^/kibana/elasticsearch/\.kibana/_mapping/\*/field/_source\?_=%{BASE10NUM}$",
        "^/kibana/elasticsearch/\.kibana/_mapping/dashboard",
        "^/kibana/elasticsearch/\.kibana/_mapping/index-pattern",
        "^/kibana/elasticsearch/\.kibana/_mapping/search",
        "^/kibana/elasticsearch/\.kibana/_mapping/visualization$",
        "^/kibana/elasticsearch/\.kibana/_refresh$",
        "^/kibana/elasticsearch/\.kibana/config/4.4.1/_update",
        "^/kibana/elasticsearch/\.kibana/dashboard/[a-zA-Z0-9_-]+$",
        "^/kibana/elasticsearch/\.kibana/dashboard/_search\?size=100$",
        "^/kibana/elasticsearch/\.kibana/index-pattern/_search\?fields=$",
        "^/kibana/elasticsearch/\.kibana/index-pattern/logstash-\*",
        "^/kibana/elasticsearch/\.kibana/index-pattern/logstash-\*\?op_type=create",
        "^/kibana/elasticsearch/\.kibana/search/Errors\?op_type=create$",
        "^/kibana/elasticsearch/\.kibana/search/Thinks-to-fix\?op_type=create",
        "^/kibana/elasticsearch/\.kibana/search/[a-zA-Z0-9._-]+$",
        "^/kibana/elasticsearch/\.kibana/search/_search\?size=%{BASE10NUM}$",
        "^/kibana/elasticsearch/\.kibana/visualization/[a-zA-Z0-9_-]+$",
        "^/kibana/elasticsearch/\.kibana/visualization/[a-zA-Z0-9_-]+\?op_type=create$",
        "^/kibana/elasticsearch/\.kibana/visualization/_search\?size=%{BASE10NUM}$",
        "^/kibana/elasticsearch/\?_=%{BASE10NUM}$",
        "^/kibana/elasticsearch/_mget\?timeout=(0|1)&ignore_unavailable=(true|false)&preference=%{BASE10NUM}$",
        "^/kibana/elasticsearch/_nodes\?_=%{BASE10NUM}$",
        "^/kibana/elasticsearch/logstash-\*/_field_stats\?level=indices$",
        "^/kibana/elasticsearch/logstash-\*/_mapping/field/\*\?_=%{BASE10NUM}&ignore_unavailable=false&allow_no_indices=false&include_defaults=true",
        "^/kibana/images/initial_load\.gif$",
        "^/kibana/images/no_border\.png$",
        "^/kibana/index\.js",
        "^/kibana/index\.js\?_b=%{BASE10NUM}$",
        "^/kibana/require\.config\.js\?_b=%{BASE10NUM}$",
        "^/kibana/status",
        "^/kibana/styles/main\.css\?_b=%{BASE10NUM}$",
        "^/kibana/styles/theme/elk\.ico$"
      ] }
    }
  }          
}
