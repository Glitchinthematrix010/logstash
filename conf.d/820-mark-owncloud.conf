filter {
  if [type] == "apache_access" and [http][request][path] =~ /^\/owncloud/ {
    mutate {
      add_field=> { "application" => "owncloud" }
    } 
    kv {
      source => "[@metadata][param_list]"
      target => "[http][request][params]"
      prefix => "%{application}_"
      field_split => "?&"
    }
    if [http][response][code] == 401 and [http][request][path] =~ /^\/owncloud\/remote\.php\// { 
      mutate {
        add_tag => [ "Known Message" ]
        remove_tag => [ ]
      }
    } else if [http][response][code] == 404 and [http][request][path] =~ /^\/owncloud\/index\.php\/core\/preview\.png\?/ {
      mutate {
        add_tag => [ "Known Message", "Benign" ]
        remove_tag => [ ]
      }
    } else if [http][response][code] and [http][response][code] < 400  {
      if [http][request][path] !~ /^\/owncloud\/(apps|core|index.php)/ {
        grok {
          patterns_dir => [ "/etc/logstash/patterns.d/" ]
          tag_on_failure => [ ]
          add_tag => [ "Known Message", "Benign" ]
          match => { "[http][request][path]" => [
            "^/owncloud(/)?$",
            "^/owncloud/ocs/v1\.php/apps/files_external/api/v1/mounts$",
            "^/owncloud/ocs/v1\.php/apps/files_sharing/api/v1/shares$",
            "^/owncloud/ocs/v1\.php/cloud/activity$",
            "^/owncloud/ocs/v1\.php/cloud/capabilities$",
            "^/owncloud/ocs/v2\.php/apps/notifications/api/v1/notifications$",
            "^/owncloud/remote\.php/$",
            "^/owncloud/remote\.php/ca(rd|l)dav/$",
            "^/owncloud/remote\.php/ca(rd|l)dav/(addressbook|calendars|principals)/(%{USER_DST}/)?(contact_birthdays|defaultcalendar)?/?$",
            "^/owncloud/remote\.php/carddav/addressbooks/%{USER_DST}/((shard_)?contacts/([a-zA-Z0-9_./-]+)?([A-F0-9-]+.vcf)?)?$",
            "^/owncloud/remote\.php/dav$",
            "^/owncloud/remote\.php/dav/addressbooks$",
            "^/owncloud/remote\.php/dav/addressbooks/users/%{USER_DST}/((shard_)?contacts/)$",
            "^/owncloud/remote\.php/dav/addressbooks/users/%{USER_DST}/contacts/$",
            "^/owncloud/remote\.php/dav/addressbooks/users/%{USER_DST}/shard_contacts/$",
            "^/owncloud/remote\.php/dav/calendars/%{USER_DST}/$",
            "^/owncloud/remote\.php/caldav/calendars/%{USER_DST}/defaultcalendar/[A-F0-9-]+.ics$",
            "^/owncloud/remote\.php/dav/principals/users/%{USER_DST}/$",
            "^/owncloud/remote\.php/dav/systemtags-relations/files/%{BASE10NUM}$",
            "^/owncloud/settings/css/settings\.css$",
            "^/owncloud/settings/img/(admin|apps|help|personal|users)\.svg$",
            "^/owncloud/settings/js/(admin|certificates|log|personal|settings)\.js$"
          ] }
        }
      } else if [http][request][path] =~ /^\/owncloud\/apps\// {
        grok {
          patterns_dir => [ "/etc/logstash/patterns.d/" ]
          tag_on_failure => [ ]
          add_tag => [ "Known Message", "Benign" ]
          match => { "[http][request][path]" => [
            "^/owncloud/apps/activity/css/(settings|style)\.css$",
            "^/owncloud/apps/activity/img/(activity|(add|delete)-color|change)\.svg$",
            "^/owncloud/apps/activity/js/(filesplugin|formatter|settings|script)\.js$",
            "^/owncloud/apps/activity/js/activity(collection|model|tabview)\.js$",
            "^/owncloud/apps/announcementcenter/css/style\.css$",
            "^/owncloud/apps/announcementcenter/img/announcementcenter\.svg$",
            "^/owncloud/apps/announcementcenter/js/script\.js$",
            "^/owncloud/apps/bookmarks/css/3rdparty/jquery\.tagit\.css$",
            "^/owncloud/apps/bookmarks/css/bookmarks\.css$",
            "^/owncloud/apps/bookmarks/img/bookmarks\.svg$$",
            "^/owncloud/apps/bookmarks/js/(bookmarks|settings)\.js$",
            "^/owncloud/apps/bookmarks/js/3rdparty/(js_tpl|tag-it)\.js$",
            "^/owncloud/apps/c(ontacts|alendar)/js/loader\.js$",
            "^/owncloud/apps/calendar/3rdparty/chosen/(cs|j)s/chosen(\.jquery\.min)?\.(css|js)$",
            "^/owncloud/apps/calendar/3rdparty/fullcalendar/(cs|j)s/fullcalendar\.(cs|j)s$",
            "^/owncloud/apps/calendar/3rdparty/jquery\.multiselect/(cs|j)s/jquery\.multiselect\.(cs|j)s$",
            "^/owncloud/apps/calendar/3rdparty/jsTz/jstz-[\d.]+\.min\.js$",
            "^/owncloud/apps/calendar/3rdparty/miniColors/(cs|j)s/jquery\.miniColors\.(min\.)?(cs|j)s$",
            "^/owncloud/apps/calendar/3rdparty/timepicker/(cs|j)s/jquery\.ui\.timepicker\.(cs|j)s$",
            "^/owncloud/apps/calendar/css/(calendar(list)?|datepicker|eventdialog|globals|settings|share|style)\.css$",
            "^/owncloud/apps/calendar/img/(calendar|(left|right)arrow)\.svg$",
            "^/owncloud/apps/calendar/img/favicon\.ico$",
            "^/owncloud/apps/calendar/js/(calendar|on-event|settings|share|jquery\.multi-autocomplete).js$",
            "^/owncloud/apps/calendar/js/public/app\.js$",
            "^/owncloud/apps/calendar/js/vendor/angular-bootstrap/ui-bootstrap(-tpls)?\.min\.js$",
            "^/owncloud/apps/calendar/js/vendor/angular-route/angular-route\.js$",
            "^/owncloud/apps/calendar/js/vendor/angular-ui-calendar/src/calendar\.js$",
            "^/owncloud/apps/calendar/js/vendor/angular/angular\.js$",
            "^/owncloud/apps/calendar/js/vendor/davclient\.js/lib/client\.js$",
            "^/owncloud/apps/calendar/js/vendor/fullcalendar/dist/fullcalendar\.(cs|j)s$",
            "^/owncloud/apps/calendar/js/vendor/fullcalendar/dist/lang-all\.js$",
            "^/owncloud/apps/calendar/js/vendor/ical\.js/build/ical\.js$",
            "^/owncloud/apps/calendar/js/vendor/jquery-timepicker/jquery\.ui\.timepicker\.css$",
            "^/owncloud/apps/calendar/js/vendor/jquery-timepicker/jquery\.ui\.timepicker\.js$",
            "^/owncloud/apps/calendar/js/vendor/jstzdetect/jstz\.min\.js$",
            "^/owncloud/apps/calendar/templates/colorpicker\.html$",
            "^/owncloud/apps/comments/css/comments\.css$",
            "^/owncloud/apps/comments/js/(app|comment(collection|model|stabview|summarymodel)|filesplugin)\.js$",
            "^/owncloud/apps/contacts/css/(contacts|multi-select|share)\.css$",
            "^/owncloud/apps/contacts/css/jquery\.(Jcrop\.min|ocaddnew)\.css$",
            "^/owncloud/apps/contacts/css/public/style\.css$",
            "^/owncloud/apps/contacts/img/(app|contacts)\.svg$",
            "^/owncloud/apps/contacts/img/favicon\.ico$",
            "^/owncloud/apps/contacts/js/(addressbooks|app|contacts|groups|jquery\.ocaddnew|modernizr\.custom|otherbackendconfig|share|storage)\.js$",
            "^/owncloud/apps/contacts/js/dav/dav\.js$",
            "^/owncloud/apps/contacts/js/public/script\.js$",
            "^/owncloud/apps/contacts/js/vendor/angular-bootstrap/ui-bootstrap(-tpls)?\.min\.js$",
            "^/owncloud/apps/contacts/js/vendor/angular-cache/dist/angular-cache\.js$",
            "^/owncloud/apps/contacts/js/vendor/angular-route/angular-route\.js$",
            "^/owncloud/apps/contacts/js/vendor/angular-sanitize/angular-sanitize\.js$",
            "^/owncloud/apps/contacts/js/vendor/angular-uuid4/angular-uuid4\.js$",
            "^/owncloud/apps/contacts/js/vendor/angular/angular\.js$",
            "^/owncloud/apps/contacts/js/vendor/jquery-timepicker/jquery\.ui\.timepicker\.js$",
            "^/owncloud/apps/contacts/js/vendor/ui-select/dist/select\.js$",
            "^/owncloud/apps/contacts/js/vendor/vcard/src/vcard\.js$",
            "^/owncloud/apps/contacts/templates/(addressBook(List)?|contact(Details|List)?)\.html$",
            "^/owncloud/apps/contacts/templates/detailItems/(adr|groups|group(List)?|hidden|tel|text(area)?)\.html$",
            "^/owncloud/apps/contacts/vendor/blueimp-file-upload/js/jquery\.fileupload\.js$",
            "^/owncloud/apps/contacts/vendor/blueimp-md5/js/md5\.min\.js$",
            "^/owncloud/apps/contacts/vendor/combobox\.js$",
            "^/owncloud/apps/contacts/vendor/jcrop/js/jquery\.Jcrop\.min\.js$",
            "^/owncloud/apps/contacts/vendor/ui-multiselect/jquery\.multiselect\.css$",
            "^/owncloud/apps/contacts/vendor/ui-multiselect/src/jquery\.multiselect\.js$",
            "^/owncloud/apps/direct_menu/css/direct_menu\.css$",
            "^/owncloud/apps/documents/css/(share|style)\.css$",
            "^/owncloud/apps/documents/css//?3rdparty/webodf/(dojo-app|wodotexteditor|wodocollabpane)\.css$",
            "^/owncloud/apps/documents/css/fonts\.css$",
            "^/owncloud/apps/documents/img/documents\.svg$",
            "^/owncloud/apps/documents/js/(admin|personal)\.js$",
            "^/owncloud/apps/documents/js/(documents|share)\.js$",
            "^/owncloud/apps/documents/js/3rdparty/resources/dijit/themes/claro/claro\.css$",
            "^/owncloud/apps/documents/js/3rdparty/resources/dojo/resources/blank\.gif$",
            "^/owncloud/apps/documents/js/3rdparty/resources/dojox/layout/resources/ExpandoPane\.css$",
            "^/owncloud/apps/documents/js/3rdparty/resources/dojox/widget/ColorPicker/ColorPicker\.css$",
            "^/owncloud/apps/documents/js/3rdparty/webodf/(dojo-amalgamation|webodf-debug)\.js$",
            "^/owncloud/apps/documents/js/3rdparty/webodf/editor/(Editor(Session)?|MemberListView|Tools)\.js$",
            "^/owncloud/apps/documents/js/3rdparty/webodf/editor/widgets/(aboutDialog|annotation|editHyperlinks|fontPicker|imageInserter|paragraphAlignment|paragraphStylesDialog|simpleStyles|undoRedoMenu)\.js$",
            "^/owncloud/apps/documents/js/3rdparty/webodf/editor/widgets/dialogWidgets/(editHyperlinkPane|idMangler)\.js$",
            "^/owncloud/apps/documents/js/3rdparty/webodf/editor/widgets/toolbarWidgets/currentStyle\.js$",
            "^/owncloud/apps/documents/js/viewer/viewer\.js$",
            "^/owncloud/apps/documents/js/widgets/(oc(Close|Logo|Share|Toolbar)|titleBar|zoomCombo)\.js$",
            "^/owncloud/apps/external/js/admin\.js$",
            "^/owncloud/apps/federation/css/settings-admin\.css$",
            "^/owncloud/apps/federation/js/settings-admin\.js$",
            "^/owncloud/apps/files/css/(detailsView|files|mobile|upload)\.css$",
            "^/owncloud/apps/files/img/(delete|external|folder|public|share|star)\.svg$",
            "^/owncloud/apps/files/js/(app|breadcrumb|detailfileinfoview|detailsview|detailtabview|favoritesfilelist|files|filesummary|file-upload|favoritesplugin|fileactions|fileactionsmenu|fileinfomodel|filelist|keyboardshortcuts|mainfileinfodetailview|navigation|newfilemenu|search|tagsplugin)\.js$",
            "^/owncloud/apps/files/js/admin\.js$",
            "^/owncloud/apps/files/js/jquery(\.fileupload|\.iframe-transport|-visibility)\.js$",
            "^/owncloud/apps/files_external/css/(external|settings)\.css$",
            "^/owncloud/apps/files_external/js/(app|mountsfilelist|rollingqueue|statusmanager|oauth(1|2)|public_key|settings)\.js$",
            "^/owncloud/apps/files_mv/css/mv\.css$",
            "^/owncloud/apps/files_mv/js/move\.js$",
            "^/owncloud/apps/files_pdfviewer/css/(style|viewer)\.css$",
            "^/owncloud/apps/files_pdfviewer/img/toolbarButton-secondaryToolbarClose\.svg$",
            "^/owncloud/apps/files_pdfviewer/js/(previewplugin|workersrc)\.js$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/build/pdf(\.worker)?\.js$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/(compatibility|l10n)\.js$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/images/(loading-(icon|small)|toolbarButton-(bookmark|download|openFile|presentationMode|print|search)|shadow)\.(gif|png)$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/images/texture\.png$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/images/toolbarButton-(menuArrows|page(|Down|Up)|secondaryToolbarToggle|sidebarToggle|view(Attachments|Outline|Thumbnail)|zoom(In|Out))\.png$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/locale/en-US/viewer\.properties$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/locale/locale.properties$",
            "^/owncloud/apps/files_pdfviewer/vendor/pdfjs/web/viewer\.(j|cs)s$",
            "^/owncloud/apps/files_sharing/css/3rdparty/gs-share/style\.css$",
            "^/owncloud/apps/files_sharing/css/settings-personal\.css$",
            "^/owncloud/apps/files_sharing/css/sharetabview\.css$",
            "^/owncloud/apps/files_sharing/img/social-(diaspora|facebook|gnu|googleplus|twitter)\.svg$",
            "^/owncloud/apps/files_sharing/js/(app|external|settings-admin|share|sharedfilelist|sharetabview)\.js$",
            "^/owncloud/apps/files_sharing/js/3rdparty/gs-share/gs-share\.js$",
            "^/owncloud/apps/files_sharing/js/settings-personal\.js$",
            "^/owncloud/apps/files_texteditor/css/(mobile|style)\.css$",
            "^/owncloud/apps/files_texteditor/css/DroidSansMono/stylesheet\.css$",
            "^/owncloud/apps/files_texteditor/js/editor\.js$",
            "^/owncloud/apps/files_texteditor/js/vendor/ace/src-noconflict/(ace|mode-python|theme-clouds)\.js$",
            "^/owncloud/apps/files_texteditor/js/vendor/ace/src-noconflict/ace\.js$",
            "^/owncloud/apps/files_trashbin/css/trash\.css$",
            "^/owncloud/apps/files_trashbin/js/(app|filelist)\.js$",
            "^/owncloud/apps/files_versions/css/versions\.css$",
            "^/owncloud/apps/files_versions/js/(filesplugin|versioncollection|versionmodel|versionstabview)\.js$",
            "^/owncloud/apps/files_video(play|view)er/css/(style|mediaelementplayer)\.css$",
            "^/owncloud/apps/files_video(play|view)er/js/viewer\.js$",
            "^/owncloud/apps/firstrunwizard/css/(colorbox|firstrunwizard)\.css$",
            "^/owncloud/apps/firstrunwizard/js/(firstrunwizard|jquery\.colorbox)\.js$",
            "^/owncloud/apps/gallery/css/(gallerybutton|github-markdown|mobile|share|slideshow|styles)\.css$",
            "^/owncloud/apps/gallery/img/(app|date(asc|des)|name(asc|des)|toggle)\.svg$",
            "^/owncloud/apps/gallery/js/(app|breadcrumb|eventsource|gallery(album|config|image|infobox|row|view)?|thumbnail)\.js$",
            "^/owncloud/apps/gallery/js/gallery(button|fileaction|utility)\.js$",
            "^/owncloud/apps/gallery/js/slideshow(controls|zoomablepreview)?\.js$",
            "^/owncloud/apps/gallery/js/vendor/bigshot/bigshot-compressed\.js$",
            "^/owncloud/apps/gallery/js/vendor/commonmark/dist/commonmark\.min\.js$",
            "^/owncloud/apps/gallery/js/vendor/dompurify/src/purify\.js$",
            "^/owncloud/apps/gallery/js/vendor/modified-eventsource-polyfill/eventsource-polyfill\.js$",
            "^/owncloud/apps/gallery/js/vendor/owncloud/share\.js$",
            "^/owncloud/apps/galleryplus/css/(gallerybutton|slideshow|github-markdown|mobile|share|styles)\.css$",
            "^/owncloud/apps/galleryplus/img/(app|dateasc|datedes|nameasc|namedes|download|toggle)\.svg$",
            "^/owncloud/apps/galleryplus/js/(app|breadcrumb|eventsource|gallery(album|button|config|fileaction|image|infobox|row|utility|view)|slideshow(controls|zoomablepreview)?|thumbnail)\.js$",
            "^/owncloud/apps/galleryplus/js/vendor/bigshot/bigshot-compressed\.js$",
            "^/owncloud/apps/galleryplus/js/vendor/commonmark/dist/commonmark\.min\.js$",
            "^/owncloud/apps/galleryplus/js/vendor/dompurify/src/purify\.js$",
            "^/owncloud/apps/galleryplus/js/vendor/image-scale/image-scale\.min\.js$",
            "^/owncloud/apps/galleryplus/js/vendor/modified-eventsource-polyfill/eventsource-polyfill\.js$",
            "^/owncloud/apps/galleryplus/js/vendor/owncloud/share\.js$",
            "^/owncloud/apps/music/css/(mobile|settings-user|style|style-controls|style-sidebar|tablet)\.css$",
            "^/owncloud/apps/music/img/(music|pause-big|play-big|play-next|play-previous|repeat|shuffle)\.svg$",
            "^/owncloud/apps/music/js/app/playerwrapper\.js$",
            "^/owncloud/apps/music/js/public/(app|fileactions|musicFilePlayer|settings-user)\.js$",
            "^/owncloud/apps/music/js/vendor/angular-gettext/dist/angular-gettext\.min\.js$",
            "^/owncloud/apps/music/js/vendor/angular-route/angular-route\.min\.js$",
            "^/owncloud/apps/music/js/vendor/angular/angular\.min\.js$",
            "^/owncloud/apps/music/js/vendor/aurora/(aurora|flac|mp3)\.js$",
            "^/owncloud/apps/music/js/vendor/restangular/dist/restangular\.min\.js$",
            "^/owncloud/apps/music/js/vendor/soundmanager/script/soundmanager2-nodebug-jsmin\.js$",
            "^/owncloud/apps/music/js/vendor/underscore/underscore-min\.js$",
            "^/owncloud/apps/notifications/css/styles\.css$",
            "^/owncloud/apps/notifications/img/notifications\.svg$",
            "^/owncloud/apps/notifications/js/(app|notification)\.js$",
            "^/owncloud/apps/ownnote/css/style\.css$",
            "^/owncloud/apps/ownnote/img/(delete(-hover)?|triangle-n)\.png$",
            "^/owncloud/apps/ownnote/img/app\.svg$",
            "^/owncloud/apps/ownnote/js/(admin|script)\.js$",
            "^/owncloud/apps/ownnote/js/tinymce/tinymce\.min\.js$",
            "^/owncloud/apps/ownnote/l10n/en\.js$",
            "^/owncloud/apps/search_lucene/css/lucene\.css$",
            "^/owncloud/apps/search_lucene/js/checker\.js$",
            "^/owncloud/apps/shorten/js/(admin|script)\.js$",
            "^/owncloud/apps/systemtags/css/systemtagsfilelist\.css$",
            "^/owncloud/apps/systemtags/img/tag\.svg$",
            "^/owncloud/apps/systemtags/js/(app|filesplugin|systemtagsfilelist|systemtagsinfoview)\.js$",
            "^/owncloud/apps/templateeditor/css/settings-admin\.css$",
            "^/owncloud/apps/templateeditor/js/settings-admin\.js$",
            "^/owncloud/apps/user_ldap/css/settings\.css$",
            "^/owncloud/apps/user_ldap/img/copy\.svg$",
            "^/owncloud/apps/user_ldap/js/wizard/(configModel|controller|view|wizard)\.js$",
            "^/owncloud/apps/user_ldap/js/wizard/wizardDetector(AvailableAttributes|BaseDN|ClearGroupMappings|ClearUserMappings|EmailAttribute|FeatureAbstract|FilterGroup|FilterLogin|FilterUser|Generic|GroupCount|GroupObjectClasses|GroupsForUsers|Port|Queue|SimpleRequestAbstract|TestAbstract|TestBaseDN|TestConfiguration|TestLoginName|UserCount|UserDisplayNameAttribute|UserGroupAssociation|UserObjectClasses)\.js$",
            "^/owncloud/apps/user_ldap/js/wizard/wizardFilterOnType(Factory)?\.js$",
            "^/owncloud/apps/user_ldap/js/wizard/wizardObject\.js$",
            "^/owncloud/apps/user_ldap/js/wizard/wizardTab(AbstractFilter|Advanced|Elementary|Expert|Generic|GroupFilter|LoginFilter|UserFilter)\.js$",
            "^/owncloud/apps/user_ldap/vendor/ui-multiselect/jquery\.multiselect\.css$",
            "^/owncloud/apps/user_ldap/vendor/ui-multiselect/src/jquery\.multiselect\.js$"
          ] }
        }
      } else if [http][request][path] =~ /^\/owncloud\/core/ {
        grok {
          patterns_dir => [ "/etc/logstash/patterns.d/" ]
          tag_on_failure => [ ]
          add_tag => [ "Known Message", "Benign" ]
          match => { "[http][request][path]" => [
            "^/owncloud/core/css/(apps|fixes|fonts|header|icons|jquery\.ocdialog|jquery-ui-fixes|mobile|multiselect|share|styles|tooltip)\.css$",
            "^/owncloud/core/css/global\.css$",
            "^/owncloud/core/css/images/ui-(icons|bg_flat|bg_glass|bg_flat|bg_highlight-soft)(_\d+)?_${BASE16NUM}_\d+x\d+\.png$",
            "^/owncloud/core/css/images/ui-bg_(flat|glass|highlight-soft)_%{BASE10NUM}_%{BASE16NUM}_%{BASE10NUM}x%{BASE10NUM}\.png$",
            "^/owncloud/core/css/images/ui-icons_%{BASE16NUM}_%{BASE10NUM}x%{BASE10NUM}\.png$",
            "^/owncloud/core/css/inputs\.css$",
            "^/owncloud/core/css/systemtags\.css$",
            "^/owncloud/core/doc/user/_static/(bootstrap-sphinx|doctools|jquery(-1\.11\.0.min|-fix)?|main\.min|pygments|styles|underscore)\.css$",
            "^/owncloud/core/doc/user/_static/bootstrap-3\.1\.0/js/bootstrap\.min\.js$",
            "^/owncloud/core/doc/user/_static/fonts/OpenSans-(Bold|Light)\.woff$",
            "^/owncloud/core/doc/user/index\.html$",
            "^/owncloud/core/fonts/OpenSans-(Light|Regular|Semibold)\.woff$",
            "^/owncloud/core/img/(appstore|breadcrumb|desktopapp|favicon|googleplay|loading|loading-dark|loading-small|logo-icon)\.(?:gif|png|svg)$",
            "^/owncloud/core/img/actions/(add|caret|checkbox(-checked(close)?|-disabled)?|confirm|delete(-white)?|download|history|info|logout|menu|more|play|search-white|settings|share|star|toggle-filelist|toggle-pictures|triangle-n|triangle-s|view-download)\.svg$",
            "^/owncloud/core/img/actions/(checkmark|checkmark-white|close|details|info|mail|rename|starred|upload|public|delete-hover|view-close|view-next|view-pause|view-play|view-previous)\.svg$",
            "^/owncloud/core/img/favicon-touch\.png$",
            "^/owncloud/core/img/favicon\.ico$",
            "^/owncloud/core/img/filetypes/(application|application-pdf|file|folder|folder-external|image|package-x-generic|text|text-code|x-office-document|package-x-generic|x-office-spreadsheet)\.(png|svg)$",
            "^/owncloud/core/img/places/(contacts-dark|files|home)\.svg$",
            "^/owncloud/core/js/(apps|avatar|compatability|config|eventsource|jquery\.avatar|jquery\.ocdialog|js|l10n|login|lostpassword|mimetype|mimetypelist)\.js$",
            "^/owncloud/core/js/(compatibility|tags)\.js$",
            "^/owncloud/core/js/(oc-backbone|oc-dialogs|oc-requesttoken|octemplate|placeholders?|share|shareconfigmodel|sharedialogexpirationview|sharedialoglinkshareview|sharedialogresharerinfoview|sharedialogshareelistview|sharedialogview|shareitemmodel|visitortimezone)\.js$",
            "^/owncloud/core/js/files/(client|fileinfo)\.js$",
            "^/owncloud/core/js/(multiselect|oc-backbone-webdav|select2-toggleselect|setupchecks)\.js$",
            "^/owncloud/core/js/systemtags/systemtag(model|s|scollection|sinputfield|smappingcollection)\.js$",
            "^/owncloud/core/search/js/search\.js$",
            "^/owncloud/core/search/templates/part\.results\.html$",
            "^/owncloud/core/vendor/[-\w_/]+/([-\w./]+/)?[-\w.]+\.(css|js)$",
            "^/owncloud/core/vendor/backbone/backbone\.js$",
            "^/owncloud/core/vendor/blueimp-md5/js/md5\.js$",
            "^/owncloud/core/vendor/bootstrap/js/tooltip\.js$",
            "^/owncloud/core/vendor/davclient\.js/lib/client\.js$",
            "^/owncloud/core/vendor/handlebars/handlebars\.js$",
            "^/owncloud/core/vendor/jquery-migrate/jquery-migrate\.min\.js$",
            "^/owncloud/core/vendor/jquery-ui/themes/base/jquery-ui\.css$",
            "^/owncloud/core/vendor/jquery-ui/ui/jquery-ui\.custom\.js$",
            "^/owncloud/core/vendor/jquery/jquery\.min\.js$",
            "^/owncloud/core/vendor/jsTimezoneDetect/jstz\.js$",
            "^/owncloud/core/vendor/moment/min/moment-with-locales\.js$",
            "^/owncloud/core/vendor/select2/select2\.png$",
            "^/owncloud/core/vendor/snapjs/dist/latest/snap\.js$",
            "^/owncloud/core/vendor/underscore/underscore\.js$",
            "^/owncloud/core/vendor/zxcvbn/zxcvbn\.js$"
          ] }
        }
      } else if [http][request][path] =~ /^\/owncloud\/index\.php/ {
        grok {
          patterns_dir => [ "/etc/logstash/patterns.d/" ]
          tag_on_failure => [ ]
          add_tag => [ "Known Message", "Benign" ]
          match => { "[http][request][path]" => [
            "^/owncloud/index\.php$",
            "^/owncloud/index\.php/apps/activity/$",
            "^/owncloud/index\.php/apps/activity/activities/fetch$",
            "^/owncloud/index\.php/apps/activity/api/v2/activity/filter$",
            "^/owncloud/index\.php/apps/activity/api/v2/activity/all$",
            "^/owncloud/index\.php/apps/announcementcenter/$",
            "^/owncloud/index\.php/apps/announcementcenter/announcement$",
            "^/owncloud/index\.php/apps/bookmarks/(bookmark/click|tag)?$",
            "^/owncloud/index\.php/apps/bookmarks/bookmark$",
            "^/owncloud/index\.php/apps/calendar/(ajax/cache/status\.php)?$",
            "^/owncloud/index\.php/apps/calendar/ajax/calendar/(activation|changeview|edit|update)(\.form)\.php$",
            "^/owncloud/index\.php/apps/calendar/ajax/event/(delete|edit|new)\.(form\.)?php$",
            "^/owncloud/index\.php/apps/calendar/ajax/events\.php$",
            "^/owncloud/index\.php/apps/calendar/ajax/settings/get(firstday|timezonedetection|timeformat)\.php$",
            "^/owncloud/index\.php/apps/calendar/ajax/settings/timeformat\.php$",
            "^/owncloud/index\.php/apps/calendar/export\.php$",
            "^/owncloud/index\.php/apps/calendar/js/idtype\.php$",
            "^/owncloud/index\.php/apps/calendar/js/l10n\.php$",
            "^/owncloud/index\.php/apps/calendar/v1/timezones/AMERICA/NEW_YORK\.ics$",
            "^/owncloud/index\.php/apps/calendar/v1/view$",
            "^/owncloud/index\.php/apps/contacts/$",
            "^/owncloud/index\.php/apps/contacts/addressbook/local/%{BASE10NUM}/contact/(%{BASE10NUM}|add)$",
            "^/owncloud/index\.php/apps/contacts/addressbook/local/%{BASE10NUM}/contacts?(/%{BASE10NUM}/photo)?$",
            "^/owncloud/index\.php/apps/contacts/addressbooks/$",
            "^/owncloud/index\.php/apps/contacts/ajax/config\.js$",
            "^/owncloud/index\.php/apps/contacts/connectors/%7Bbackend%7D$",
            "^/owncloud/index\.php/apps/contacts/groups/$",
            "^/owncloud/index\.php/apps/contacts/groups/addto/%{BASE10NUM}$",
            "^/owncloud/index\.php/apps/contacts/preference/set$",
            "^/owncloud/index\.php/apps/documents/ajax/documents/list$",
            "^/owncloud/index\.php/apps/documents/ajax/mimes\.php$",
            "^/owncloud/index\.php/apps/documents/index$",
            "^/owncloud/index\.php/apps/files/?$",
            "^/owncloud/index\.php/apps/files/ajax/(list|scan|getstoragestats)\.php$",
            "^/owncloud/index\.php/apps/files/ajax/download\.php$",
            "^/owncloud/index\.php/apps/files/ajax/upload.php$",
            "^/owncloud/index\.php/apps/files_external/globalstorages(/%{BASE10NUM})?$",
            "^/owncloud/index\.php/apps/files_external/user(global)?storages(/%{BASE10NUM})?$",
            "^/owncloud/index\.php/apps/files_pdfviewer/$",
            "^/owncloud/index\.php/apps/files_sharing/api/externalShares$",
            "^/owncloud/index\.php/apps/files_texteditor/ajax/loadfile$",
            "^/owncloud/index\.php/apps/files_texteditor/ajax/savefile$",
            "^/owncloud/index\.php/apps/files_versions/ajax/getVersions\.php$",
            "^/owncloud/index\.php/apps/gallery/$",
            "^/owncloud/index\.php/apps/gallery/config$",
            "^/owncloud/index\.php/apps/gallery/files/list$",
            "^/owncloud/index\.php/apps/gallery/preview/%{BASE10NUM}$",
            "^/owncloud/index\.php/apps/gallery/slideshow$",
            "^/owncloud/index\.php/apps/gallery/thumbnails$",
            "^/owncloud/index\.php/apps/galleryplus/$",
            "^/owncloud/index\.php/apps/galleryplus/config$",
            "^/owncloud/index\.php/apps/galleryplus/config$",
            "^/owncloud/index\.php/apps/galleryplus/files/download/\d+$",
            "^/owncloud/index\.php/apps/galleryplus/files/list$",
            "^/owncloud/index\.php/apps/galleryplus/preview/%{BASE10NUM}$",
            "^/owncloud/index\.php/apps/galleryplus/slideshow$",
            "^/owncloud/index\.php/apps/galleryplus/thumbnails$",
            "^/owncloud/index\.php/apps/music/$",
            "^/owncloud/index\.php/apps/music/api/album/\d+/cover$",
            "^/owncloud/index\.php/apps/music/api/collection$",
            "^/owncloud/index\.php/apps/music/api/scan$",
            "^/owncloud/index\.php/apps/ownnote/$",
            "^/owncloud/index\.php/apps/ownnote/api/v%{BASE10NUM}/ownnote/(mobileindex|version)$",
            "^/owncloud/index\.php/apps/ownnote/ajax/v%{BASE10NUM}/ownnote/ajax(announcement|index)$",
            "^/owncloud/index\.php/apps/user_ldap/ajax/(get|test)Configuration.php$",
            "^/owncloud/index\.php/apps/user_ldap/ajax/wizard\.php$",
            "^/owncloud/index\.php/avatar/%{USER_DST}/%{BASE10NUM}$",
            "^/owncloud/index\.php/core/ajax/share\.php$",
            "^/owncloud/index\.php/core/js/oc\.js$",
            "^/owncloud/index\.php/core/preview\.png$",
            "^/owncloud/index\.php/displaynames$",
            "^/owncloud/index\.php/s/[A-Za-z0-9]+(/download)?$",
            "^/owncloud/index\.php/settings/(admin|help|personal)$",
            "^/owncloud/index\.php/settings/ajax/checksetup$",
            "^/owncloud/index\.php$"
          ] }
        }
      }
    }
    if [files][dst][filename] {
      urldecode {
        field => "[files][dst][filename]"
      }
    }
  }
  if [type] == "owncloud" {
    if [http][request][path] =~ /\/notifications$/ and [message] == "Current user is not logged in" {
      mutate {
        add_tag => [ "Known Message", "Benign" ]
      }
    } 
    grok {
      tag_on_failure => [ ]
      add_tag => [ "Known Message", "Error" ]
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      match => { "message" => [
        "^Current user is not logged in$",
        "^%{PATH} is locked$",
        "^Bind failed: 49: Invalid credentials$",
        "^Failed to connect to the database: An exception occured in driver: SQLSTATE\[HY000\] \[2005\] Unknown MySQL server host \'%{IP_DST}\' \(2\)$",
        "^File: %{PATH} modified since opening\.$",
        "^HTTP\/[12]\.[10] 401 Username or password was incorrect$",
        "^HTTP\/[12]\.[10] 501 There was no handler found for this \"LOCK\" method$",
        "^HTTP\/[12]\.[10] 503 Doctrine\\DBAL\\DBALFailed to connect to the database: An exception occured in driver: SQLSTATE\[HY000\] \[2005\] Unknown MySQL server host \'%{IP_DST}\' \(2\)$",
        "^HTTP\/[12]\.[10] 503 OC\\ServerNotAvailableLost connection to LDAP server\.$",
        "^LDAP error Invalid credentials \(49\) after calling ldap_bind$",
        "^Login failed: \'%{USER_DST}\' \(Remote IP: \'%{IP_SRC}\'\)$",
        "^Lost connection to LDAP server\.$",
        "^OCA\\Contacts\\Backend\\Database::getContact, Not found, id: %{BASE10NUM}$",
        "^updateByPath - file not found - %{DATA:[files][dst][filename]}$"
      ] }
    }
    grok {
      tag_on_failure => [ ]
      add_tag => [ "Known Message", "Alert" ]
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      match => { "message" => [
        "^Bind failed: 49: Invalid credentials$",
        "^Failed to connect to the database: An exception occured in driver: SQLSTATE\[HY000\] \[2005\] Unknown MySQL server host \'%{IP_DST}\' \(2\)$",
        "^HTTP\/[12]\.[10] 401 Username or password was incorrect$",
        "^HTTP\/[12]\.[10] 401 Username or password does not match$",
        "^LDAP error Invalid credentials \(49\) after calling ldap_bind$",
        "^Login failed: \'%{USER_DST}\' \(Remote IP: \'%{IP_SRC}\'\)$"
      ] }
    }
    grok {
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      tag_on_failure => [ ]
      add_tag => [ "Known Message", "Benign" ]
      match => { "message" => [
        "^initializing paged search for",
        "^readAttribute: ",
        "^Requested attribute ",
        "(m?)^initializing paged search for  ?Filter (objectClass=\*|(\(&)?\(&\(\|\(objectclass=nestedgroup\)\)\(\|(\((cn|uid)=%{DATA}\))+\)\)(\(cn=\*\))?)(\))? base Array\n\(\n\s+\[0\] => ((cn|uid)=%{DATA},)?cn=(groups|users),cn=accounts,%{SITE_LDAP_BASE}\n\)\n attr Array\n\(\n(\s+\[\d\] => %{OC_LDAP_USER_ATTRS}\n)+\)\n limit (500|2) offset 0$",
        "^(Run|Finished) job with ID \d+$",
        "^Accessing the API class is deprecated\! Use the appropriate services instead\!$",
        "^Count filter: objectclass=*$",
        "^Expire: %{URIFILEPATH:[files][dst][filename]}\.v%{BASE10NUM:[files][dst][version]}$",
        "^Generating preview for \".+\" with \"OC\\Preview\\\w+\"$",
        "^HTTP\/[12]\.[10] 401 No 'Authorization: Basic' header found. Either the client didn't send one, or the server is mis-configured$",
        "^HTTP\/[12]\.[10] 401 No basic authentication headers were found$",
        "^HTTP\/[12]\.[10] 404 File with name %{DATA:[files][dst][filename]} could not be located$",
        "^HTTP\/[12]\.[10] 400 The {DAV:}property-search element must contain one {DAV:}match and one {DAV:}prop element$",
        "^HTTP\/[12]\.[10] 405 The resource you tried to create already exists$",
        "^HTTP\/[12]\.[10] 423 \"[0-9a-zA-Z_. -]+\" is locked$",
        "^Looking for cookie L/O 500/0$",
        "^Mark to expire %{DATA:[files][dst][filename]} next version should be %{BASE10NUM} or smaller\. \(prevTimestamp: %{BASE10NUM}; step: %{BASE10NUM}$",
        "^More than one result$",
        "^No DN found for\s+on ldaps://%{SITE_LDAP_SERVERS}/$",
        "^No paged search for us, Cpt., Limit %{BASE10NUM} Offset %{BASE10NUM}$",
        "^OCA\\Contacts\\Contact::setPropertyByChecksum adding: TEL( [0-9(). -]+)?$",
        "^OCA\\Contacts\\Contact::setPropertyByName adding: (FN|NOTE) .*$",
        "^OCA\\Contacts\\Hooks::contactAdded id: %{BASE10NUM}$",
        "^OCA\\Contacts\\Utils\\Properties::purgeIndexes, ids: Array$",
        "^OCA\\Contacts\\Utils\\Properties::purgeIndexes, ids: Array\n\(\n   \[0\] => \d+\n\)",
        "^OC_Image->fixOrientation\(\) (Orientation: -?\d+|Image is not a JPEG\.)$",
        "^Paged search was not available$",
        "^Ready for a paged search$",
        "^Requested attribute (displayname|thumbnailphoto|jpegphoto|mail|primarygroupid) not found for uid=%{USER_DST},cn=users,cn=accounts,%{SITE_LDAP_BASE}$",
        "^Requested attribute (memberof) not found for cn=%{USER_DST},cn=groups,cn=accounts%{SITE_LDAP_BASE}$",
        "^Requested attribute .* not found for cn=.*%{SITE_LDAP_BASE}$",
        "^Rescan triggered$",
        "^Run background job \"updateGroups\"$",
        "^Secured pdf file are currently not supported\.",
        "^\d+ orphaned ((user|system) tag relations|comments|read marks) deleted$",
        "^\d+ orphaned comment read marks deleted$",
        "^\d+ orphaned share\(s\) deleted$",
        "^adding \d+ {\"boost\":1}$",
        "^background job (indexing \d+ files|optimizing index) for %{USER_DST}$",
        "^bgJ \"updateGroups\" – (FINISHED )?[dD]ealing with ((creat|remov)ed|known) [gG]roups\.$",
        "^bgJ \"updateGroups\" – Finished\.$",
        "^delete - \d+$",
        "^extracted metadata - artist: %{DATA}, album: audiodata, title: %{DATA}, track#: %{BASE10NUM}?, year: %{BASE10NUM}?, mimetype: %{DATA}, length: %{BASE10NUM}, bitrate: %{BASE10NUM}, fileId: %{DATA}?, this-\>userId: %{USER_DST}, userId: %{USER_DST}$",
        "^found \d+ hits for file id [ #.a-zA-Z0-9_+/-]+$",
        "^getGroups Filter (objectClass=\*|(\(&)?\(&\(\|\(objectclass=nestedgroup\)\)\(\|(\(cn=%{DATA}\))+\)\)(\(cn=\*\))?)(\))?$",
        "^getGroups getGroups--500-0$",
        "^getGroups\(\): read \d+ at offset \d+ \(limit: 500\)$",
        "^getUsers: Options: search  limit 500 offset (500)? Filter: \(&\(&\(|\(objectclass=inetorgperson\)\)\(|\(memberof=cn=%{USERNAME:group_dst},cn=groups,cn=accounts,%{SITE_LDAP_BASE}\)\)\)\(displayname=\*\)\(displayname=\*\)\)$",
        "^getUsers: \d+ Users found$",
        "^max(X|Y) reduced from \d+ to \d+$",
        "^optimizing index$",
        "^readAttribute: cn=%{USERNAME:group_dst},cn=groups,cn=accounts,%{SITE_LDAP_BASE} found$",
        "^readAttribute: uid=%{USER_DST},cn=users,cn=accounts,%{SITE_LDAP_BASE} found$",
        "^removed \d+ files from index$",
        "^removed entities - albums: \[\], artists: \[\]$",
        "^removing \d+:[ #.a-zA-Z0-9_+/-]+ from index$",
        "^update - [ #.a-zA-Z0-9_+/%-]+$",
        "^update - mimetype [a-zA-Z0-9-]+/[a-zA-Z0-9-]+$"
      ] }
    }
  }
  if [syslog][identifier] == "CROND" and [message] =~ /owncloud\/cron.php\)$/ {
    grok {
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      tag_on_failure => [ ]
      add_tag => [ "Known Message", "Benign" ]
      add_field => { "application" => "owncloud" }
      match => { "message" => [ "^\(apache\) CMD \(/opt/rh/rh-php56/root/usr/bin/php -f /var/www/html/owncloud/cron\.php\)$",
                                "^\(apache\) CMD \(/usr/bin/php -f /var/www/html/owncloud/cron\.php\)$"
      ] }
    }
  }
}
