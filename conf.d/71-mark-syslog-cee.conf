filter {
  if [type] == "syslog" or [type] == "cee" {
    if [syslog_identifier] == "dnsmasq" {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message" ]
        match => { "message" => [
          "^possible DNS-rebind attack detected: %{IP_SRC}$"
        ] }
      }
    }
    if [syslog_identifier] == "CROND" {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign"  ]
        match => { "message" => [
          "^\(apache\) CMD \(php -f /var/www/html/owncloud/cron\.php\)$",
          "^\(root\) CMD \(/usr/sbin/logrotate /etc/logrotate\.d/libvirtd\)$",
          "^\(root\) CMD \(/usr/lib64/sa/sa1 1 1\)$",
          "^\(root\) CMD \(run-parts /etc/cron\.hourly\)$"
        ] }
      }
    }
    if [syslog_identifier] =~ /^run-parts\(.+\)$/ {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^(finished|starting) (0anacron|0yum-hourly\.cron|0yum-daily\.cron|0logwatch|man-db\.cron|mod-pagespeed|logrotate|vdsm-logrotate|mysql-backup|pam_shield)$"
        ] }
      }
    }
    if [syslog_identifier] == "auditd"  {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^Audit daemon rotating log files$"
        ] }
      }
    }
    if [syslog_identifier] == "dropbear"  {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^Child connection from %{IP_SRC}:%{NUMBER:port_src}$",
          "^Password auth succeeded for '%{USERNAME:username_dst}' from %{IP_SRC}:%{NUMBER:port_src}$",
          "^Exit \(%{USERNAME:username_dst}\): Exited normally$"
        ] }
      }
    }
    if [syslog_identifier] == "anacron"  {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^Job `.+' locked by another anacron - skipping$",
          "^Anacron [.[:alnum:]]+ started on [0-9-]+$",
          "^Anacron started on [0-9-]+$",
          "^Jobs will be executed sequentially$",
          "^Normal exit \([0-9]+ jobs? run\)$",
          "^Will run job `[._[:alnum:]-]+' in [0-9]+ min\.$",
          "^Job `[._[:alnum:]-]+' started$",
          "^Job `[._[:alnum:]-]+' terminated$",
          "^Job `[._[:alnum:]-]+' terminated (\(exit status: [[:digit:]]+\) )?\(mailing output\)$",
          "^Updated timestamp for job `[._[:alnum:]-]+' to [0-9-]+$"
        ] }
      }
    }
    if [syslog_identifier] == "java"  {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^%{TIME} \[ajp-apr-8009-exec-\d+\] INFO  o\.g\.g\.n\.b\.rest\.auth\.TokenRESTService - User \"%{USERNAME:username_dst}\" successfully authenticated from %{IP_SRC}\.$",
          "^%{TIME} \[ajp-apr-8009-exec-\d+\] INFO  o\.g\.g\.n\.b\.BasicGuacamoleTunnelServlet - Using HTTP tunnel \(not WebSocket\)\. Performance may be sub-optimal\.$",
          "^%{TIME} \[ajp-apr-8009-exec-\d+\] INFO  o\.g\.g\.net\.basic\.TunnelRequestService - User \"%{USERNAME:username_dst}\" successfully connected to \".+\"\.$"
        ] }
      }
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ ]
        add_tag => [ "Known Message"]
        remove_tag => [ "Unknown Message" ]
        match => { "message" => [
          "^%{TIME} \[ajp-apr-8009-exec-\d+\] WARN  o\.g\.g\.s\.GuacamoleHTTPTunnelServlet - HTTP tunnel request rejected: No such tunnel\.$"
        ] }
      }
    
    }
    if [syslog_identifier] =~ /^postfix\//  {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^connect to smtp\.gmail\.com\[[0-9a-f:]+\]:587: Network is unreachable$",
          "^[0-9A-F]{12}: removed$",
          "^[[:alnum:]]+: from=<[^[:space:]]*>, size=[[:digit:]]+, nrcpt=[[:digit:]]+ \(queue active\)$",
          "^[0-9A-F]{12}: message-id=\S+$",
          "^[[:upper:][:digit:]]+: to=<[^[:space:]]+>,( orig_to=<[^[:space:]]+>,)? relay=[._[:alnum:]-]+\[[[:digit:].]{7,15}\](:[[:digit:]]{1,5})?, (conn_use=[[:digit:]]+, )?delay=[.[:digit:]]+(, delays=([.[:digit:]]+/){3}[.[:digit:]]+)?(, dsn=2(\.[[:digit:]]+){2})?, status=sent \(2[[:digit:]][[:digit:]] .+\)$",
          "^[[:upper:][:digit:]]+: to=<[^[:space:]]+>,( orig_to=<[^[:space:]]+>,)? relay=local, delay=[[:digit:].]+(, delays=([.[:digit:]]+/){3}[.[:digit:]]+)?(, dsn=[245](\.[[:digit:]]+){2})?, status=sent \(.+\)$",
          "^[0-9A-F]{12}: uid=\d+ from=\S+$",
          "^[0-9A-F]{12}: message-id=<[0-9A-Z@.]+>$"
        ] }
      }
    }
    if [syslog_identifier] == "polkitd" {
      grok {
        patterns_dir => [ "/etc/logstash/patterns.d/" ]
        tag_on_failure => [ "Unknown Message" ]
        add_tag => [ "Known Message", "Benign" ]
        match => { "message" => [
          "^Registered Authentication Agent for unix-process:\d+:\d+ \(system bus name :\d+\.\d+ \[/usr/bin/pkttyagent --notify-fd 5 --fallback\], object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale en_US\.UTF-8\)$",
          "^Unregistered Authentication Agent for unix-process:\d+:\d+ \(system bus name :\d+\.\d+, object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale en_US\.UTF-8\) \(disconnected from bus\)$"
        ] }
      }
    }
  }
}
