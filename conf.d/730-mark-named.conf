filter {
  if [type] == "syslog" or [type] == "cee" and [syslog][identifier] == "named" {
    mutate {
      add_field => { "application" => "BIND" }
    }
    grok {
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      tag_on_failure => [ ]
      add_tag => [ "Known Message", "Benign" ]
      match => { "message" => [
        "^----------------------------------------------------$",
        "^BIND 9 is maintained by Internet Systems Consortium,$",
        "^Inc\. \(ISC\), a non-profit 501\(c\)\(3\) public-benefit $",
        "^\[truncated\] built with",
        "^all zones loaded$",
        "^automatic empty zone: %{DATA:[bind][zone]}$",
        "^available at https://www.isc.org/support$",
        "^client %{SITE_DNS_PRIMARY:[host][src][ipv4]}#%{PORT_SRC}: received notify for zone \'%{SITE_DOMAINS}\'$",
        "^clients-per-query (in|de)creased to %{INT}$",
        "^configuring command channel from '/etc/rndc\.key'+$",
        "^corporation\.  Support and training for BIND 9 are $",
        "^dispatch 0x%{BASE16NUM}: open_socket\(0\.0\.0\.0#\d+\) -> permission denied: continuing$",
        "^exiting$",
        "^generating session key for dynamic DNS$",
        "^listening on IPv4 interface %{INTF_SRC}, %{IP_DST}#%{PORT_DST}$",
        "^loading configuration from '/etc/bind/named\.conf'$",
        "^managed-keys-zone: loaded serial \d+$",
        "^no longer listening on %{IP_DST}(#%{PORT_DST})?$",
        "^running$",
        "^set up managed keys zone for view %{DATA:[bind][view][name]}, file \'%{DATA:[files][src][filename]}\'$",
        "^shutting down$",
        "^sizing zone task pool based on \d+ zones$",
        "^starting BIND [0-9.P-]+ (-(4|6))? -u %{USER_DST} -f -c %{PATH:[files][src][filename]}$",
        "^success resolving '%{DATA:[bind][dst][hostname]' \(in '%{DATA:[bind][dst][zone]}'\?\) after (disabling EDNS|reducing the advertised EDNS UDP packet size to %{INT} octets)$",
        "^transfer of '%{DATA:[bind][zone]}/IN' from %{IP_DST}#%{PORT_DST}: Transfer completed: %{INT} messages, %{INT} records, %{INT} bytes, %{BASE10NUM} secs \(%{INT} bytes/sec\)$",
        "^transfer of '%{DATA:[bind][zone]}/IN' from %{IP_DST}#%{PORT_DST}: connected using %{IP_SRC}#%{PORT_SRC}$",
        "^using %{INT} UDP listener per interface$",
        "^using default UDP/IPv4 port range: \[1024, 65535\]$",
        "^using up to %{INT} sockets$",
        "^zone %{DATA:[bind][zone]}/IN: (Transfer started\.|transferred serial %{INT:[bind][src][serial]}|loaded serial %{INT:[bind][src][serial]})$",
        "^zone %{DATA:[bind][zone]}/IN: serial number \(%{INT:[bind][src][serial]}\) received from master %{IP_SRC}#%{PORT_SRC} < ours \(%{INT:[bind][dst][serial]}\)$",
        "^zone %{DATA:[bind][zone]}/IN: sending notifies \(serial %{INT:[bind][dst][serial]}\)$"

      ] }
    }
    grok {
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      tag_on_failure => [ ]
      add_tag => [ "Known Message", "Error" ]
      match => { "message" => [
        "^couldn't add command channel %{IP_DST}#%{PORT_DST}: file not found$",
        "^dumping master file: %{PATH:[files][dst][filename]}: open: (file not found|permission denied)$",
        "^error \(connection refused\) resolving '%{HOST_DST}/(A|AAAA)/IN': %{IP_DST}#%{PORT_DST}$",
        "^error \(unexpected RCODE (REFUSED|SERVFAIL)\) resolving '%{HOST_DST}/(A|AAAA)/IN': %{IP_DST}#%{PORT_DST}$",
        "^error \(unexpected RCODE (REFUSED|SERVFAIL)\) resolving '%{IP}\.in-addr\.arpa/PTR/IN': %{IP_DST}#%{PORT_DST}$",
        "^lame server resolving '%{IP}\.in-addr\.arpa' \(in '[0-9.]+\.in-addr\.arpa'\?\): %{IP_DST}#%{PORT_DST}$"
      ] }
    }
  }
}
