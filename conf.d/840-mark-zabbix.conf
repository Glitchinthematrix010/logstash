filter {
  if [http][request][path] =~ /^\/zabbix/ and [http][response][code] and [http][response][code] < 400 {
    mutate {
      add_field => { "application" => "zabbix" }
    }
    kv {
      source => "[@metadata][param_list]"
      target => "[http][request][params]"
      prefix => "%{application}_"
      field_split => "?&"
    }
    grok {
      patterns_dir => [ "/etc/logstash/patterns.d/" ]
      tag_on_failure => [ "Unknown Message" ]
      add_tag => [ "Known Message", "Benign" ]
      match => { "[http][request][path]" => [
        "^/zabbix(/)?$",
        "^/zabbix/(adm\.gui|authentication|profile|queue|usergrps|users)\.php$",
        "^/zabbix/api_jsonrpc\.php$",
        "^/zabbix/chart2\.php$",
        "^/zabbix/chart\.php$",
        "^/zabbix/charts\.php$",
        "^/zabbix/dashboard\.php$",
        "^/zabbix/discovery\.php$",
        "^/zabbix/favicon.ico$",
        "^/zabbix/graphs.php$",
        "^/zabbix/hostgroups\.php$",
        "^/zabbix/hosts\.php$",
        "^/zabbix/images/general/(sort_(down|up)|unknown_icon)\.png$",
        "^/zabbix/images/general/(zabbix_unknown|zabbix_available|warning2|snmp_unknown|snmp|unavailable|plus|multiselect|minus|jmx_unknown|ipmi_unknown|error3|dbl_arrow_down2|dbl_arrow_up2|chart)\.png$",
        "^/zabbix/images/general/bar/(bar_(bg|middle)|bg|left(_arr)?|right(_arr)?)\.png$",
        "^/zabbix/images/general/bttn/(arrowup|arrowdown|config|fullscreen|minus|menu|plus|reset)\.png$",
        "^/zabbix/images/general/login/(background|glow|logo)\.png$",
        "^/zabbix/images/general/zabbix\.(ico|png)$",
        "^/zabbix/images/gradients/(button|menu_not_active)\.gif$",
        "^/zabbix/img/apple-touch-icon-\d{1,3}x\d{1,3}-precomposed.png$",
        "^/zabbix/img/browser-sprite.png$",
        "^/zabbix/img/icon-sprite\.svg$",
        "^/zabbix/img/touch-icon-192x192\.png$",
        "^/zabbix/index\.php$",
        "^/zabbix/js/browsers\.js$",
        "^/zabbix/js/class.pmaster.js$",
        "^/zabbix/jsLoader\.php$",
        "^/zabbix/jsrpc\.php$",
        "^/zabbix/latest\.php$",
        "^/zabbix/map\.php$",
        "^/zabbix/profile\.php$",
        "^/zabbix/screenconf\.php$",
        "^/zabbix/screens\.php$",
        "^/zabbix/styles/%{DATA}pagespeed\.cf\.%{DATA}\.css$",
        "^/zabbix/styles/(blocks|color|default|icon|pages|blue-theme)\.css$",
        "^/zabbix/styles/themes/%{DATA}/(jquery-ui|main)\.css$",
        "^/zabbix/styles/themes/%{DATA}/images/bg_(flat|h-hard|i-hard)_%{INT}(_%{BASE16NUM})?\.png$",
        "^/zabbix/styles/themes/%{DATA}/images/icons_%{BASE16NUM}\.png$",
        "^/zabbix/templates\.php$",
        "^/zabbix/zabbix\.php$"
      ] }
    }
  }          
}
